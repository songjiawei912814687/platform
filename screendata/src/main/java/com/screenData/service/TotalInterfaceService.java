package com.screenData.service;import com.alibaba.fastjson.JSONObject;import com.common.response.ResponseResult;import com.screenData.config.RedisComponent;import com.screenData.core.base.BaseMapper;import com.screenData.core.base.BaseService;import com.screenData.core.base.MybatisBaseMapper;import com.screenData.domain.output.TotalInterfaceOutput;import com.screenData.mapper.jpa.ConfigRepository;import com.screenData.mapper.jpa.TotalInterfaceRepository;import com.screenData.mapper.mybatis.FeedbackInfoMapper;import com.screenData.mapper.mybatis.TotalInterfaceMapper;import com.screenData.model.Config;import com.screenData.model.MapCenter;import com.screenData.model.TotalInterface;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.List;/** * @author: XiGuoQing * @description: * @date: Created in 下午 2:07 2018/10/30 0030 * @modified by: */@Servicepublic class TotalInterfaceService extends BaseService<TotalInterfaceOutput, TotalInterface,Integer> {  @Autowired  private TotalInterfaceRepository totalInterfaceRepository;  @Autowired  private TotalInterfaceMapper totalInterfaceMapper;  @Autowired  private FeedbackInfoMapper feedbackInfoMapper;  @Autowired  private ConfigRepository configRepository;  @Autowired  private MapCenterService mapCenterService;  @Autowired  private RedisComponent redisComponent;  @Override  public BaseMapper<TotalInterface, Integer> getMapper() {    return totalInterfaceRepository;  }  @Override  public MybatisBaseMapper<TotalInterfaceOutput> getMybatisBaseMapper() {    return totalInterfaceMapper;  }  public static final Integer IS_USE = 0;  public static final Integer UN_USE = 1;  public ResponseResult selectCount(){    Object obj = redisComponent.getHash("totalInterface","totalInterface");    if(obj!=null){      return ResponseResult.success(JSONObject.parse(obj.toString()));    }    TotalInterface totalInterface = new TotalInterface();    Config config = configRepository.findByConfigKey("办件总量");    if(config==null){      return ResponseResult.success();    }    //state 0为有效参数    if(IS_USE.equals(config.getState())){      totalInterface.setAllCount(Integer.valueOf(config.getConfigValue()));    }else {      //否则查出总的办件量      totalInterface.setAllCount(feedbackInfoMapper.selectSum());    }    List<MapCenter> mapCenterList = mapCenterService.selectCount();    Integer windowCount = 0;    for(MapCenter mapCenter:mapCenterList){      windowCount += mapCenter.getWindowCount();    }    //窗口模块下所有窗口数    totalInterface.setWindowCount(windowCount);    redisComponent.setHash("totalInterface","totalInterface", JSONObject.toJSON(totalInterface).toString(),8*60*60L);    return ResponseResult.success(totalInterface);  }}